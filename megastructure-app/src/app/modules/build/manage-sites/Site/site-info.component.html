<h2 mat-dialog-title>Manage Site {{ site.name }}</h2>
<mat-dialog-content class="mat-typography">
  <form
    id="site-form"
    class="col-sm-11 col-lg-5 col-xl-4"
    [formGroup]="siteForm"
    (ngSubmit)="save()"
  >
    <div>
      <mat-form-field>
        <input
          matInput
          placeholder="Site Name"
          formControlName="name"
          required
        />
      </mat-form-field>
    </div>

    <div>
      <mat-form-field>
        <input matInput placeholder="Type" formControlName="type" required />
      </mat-form-field>
    </div>

    <div
      formArrayName="managers"
      *ngFor="
        let manager of siteForm.get('managers')['controls'];
        let i = index
      "
    >
      <ng-template
        [ngIf]="i !== siteForm.get('managers')['controls'].length - 1"
        [ngIfElse]="addManagerInput"
      >
        <div>{{ siteForm.controls['managers'].controls[i].controls.username.value }}</div>
      </ng-template>

      <ng-template #addManagerInput>
        <div [formGroupName]="i">
          <mat-form-field>
            <input
              matInput
              placeholder="Add Manager"
              formControlName="username"
            />
          </mat-form-field>
          <button
            mat-flat-button
            type="button"
            (click)="addManager()"
          >
            <fa name="plus"></fa>
          </button>
        </div>
      </ng-template>
    </div>

    <div *ngIf="siteForm.errors">
      <span *ngFor="let error of siteForm.errors">{{ error }}</span>
    </div>
  </form>
</mat-dialog-content>
<mat-dialog-actions align="end">
  <button mat-button [mat-dialog-close]="false">Cancel</button>
  <button
    mat-flat-button
    type="submit"
    [disabled]="!siteForm.valid"
    form="site-form"
    color="primary"
  >
    Save
  </button>
</mat-dialog-actions>
